---
title: "Mini-Project 2"
author: "Hening Zheng, Jaime Pettit"
date: "October 31, 2017"
output: html_document
---


## Loading the data

This project is so interesting and relevant to my life!

```{r, include=FALSE}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
library(tidyverse)
```

```{r, message=FALSE}
ct <- house_elections %>%
  filter(state == "CT") %>%
  select(-fec_id, -incumbent, -state) %>%
  group_by(party) %>%
  arrange(district)
  
ct

ct_party <- ct %>%
  summarize(N = n(),
            dist1 = sum(ifelse(district == '01', 1, 0)),
            dist2 = sum(ifelse(district == '02', 1, 0)),
            dist3 = sum(ifelse(district == '03', 1, 0)),
            dist4 = sum(ifelse(district == '04', 1, 0)),
            dist5 = sum(ifelse(district == '05', 1, 0)),
            primary = sum(primary_votes),
            general = sum(general_votes)) %>%
  arrange(desc(general))

ct_party

party_by_state <- function(state_arg) {
  house_elections %>%
  filter(state == state_arg) %>%
  select(-fec_id, -incumbent, -state) %>%
  group_by(party) %>%
  summarize(N = n(),
            primary = sum(primary_votes),
            general = sum(general_votes)) %>%
  arrange(desc(general))
}

winner_party <- function(state_arg) {
  partydata <- party_by_state(state_arg) 
  general_winner <- partydata[1,]
  partydata %>% summarize(state = state_arg,
                          party = general_winner$party,
                          ratio = general_winner$general/sum(general))
}

party <- function(state_arg, party_arg) {
  partydata <- party_by_state(state_arg) 
  votes <- partydata %>% subset(party == party_arg)
  partydata %>% summarize(state = state_arg,
                          ratio = votes$general[1]/sum(general))
}

d_party <- function(state_arg) {
  party(state_arg, "D") 
}

comparison <- function(state_arg) {
  partydata <- party_by_state(state_arg) 
  winner_party <- partydata[1,]
  dem <- partydata %>% subset(party == "D")
  rep <- partydata %>% subset(party == "R")
  partydata %>% summarize(state = state_arg,
                          total_votes = sum(general),
                          winner = winner_party$party[1],
                          dem_votes = dem$general[1],
                          dem_ratio = dem_votes/total_votes,
                          rep_votes = rep$general[1],
                          rep_ratio = rep_votes/total_votes)
}

swing_states <- function(state_arg) {
  partydata <- party_by_state(state_arg) 
  winner_party <- partydata[1,]
  dem <- partydata %>% subset(party == "D")
  rep <- partydata %>% subset(party == "R")
  partydata %>% summarize(state = state_arg,
                          total_votes = sum(general),
                          winner = winner_party$party[1],
                          dem_votes = dem$general[1],
                          rep_votes = rep$general[1],
                          dem_vs_rep = dem_votes/rep_votes,
                          swing = abs(dem_vs_rep-1))
}

states <- house_elections %>% 
  select(state) %>%
  unique()

swing_data <- lapply(states$state, swing_states) %>%
  bind_rows() %>%
  filter(swing < 0.1) %>%
  arrange(swing)

swing_data

```
  